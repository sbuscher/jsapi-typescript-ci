{"version":3,"file":"arcgisLayers.45a19a37.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import r from\"../../core/Error.js\";import{isNone as a,isSome as t}from\"../../core/maybe.js\";import{getFilename as s,urlToObject as n}from\"../../core/urlUtils.js\";import{parse as l,parseNonStandardSublayerUrl as o}from\"./arcgisLayerUrl.js\";import{layerLookupMap as u}from\"./lazyLayerLoader.js\";async function y(e){const r=e.properties?.customParameters,a=await f(e.url,r),t={...e.properties,url:e.url};if(!a.sublayerIds)return null!=a.layerOrTableId&&(t.layerId=a.layerOrTableId,t.sourceJSON=a.sourceJSON),new a.Constructor(t);const s=new(0,(await import(\"../GroupLayer.js\")).default)({title:a.parsedUrl.title});return c(s,a,t),s}function i(e,r){return e?e.find((e=>e.id===r)):null}function c(e,r,a){function s(e,s){const n={...a,layerId:e,sublayerTitleMode:\"service-name\"};return t(s)&&(n.sourceJSON=s),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const t=s(a,i(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=s(a,i(r.tableInfos,a));e.tables.add(t)}))}async function f(e,t){let s=l(e);if(a(s)&&(s=await d(e,t)),a(s))throw new r(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:e});const{serverType:n,sublayer:o}=s;let u;const y={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"};switch(n){case\"MapServer\":u=null!=o?\"FeatureLayer\":w(e,t).then((e=>e?\"TileLayer\":\"MapImageLayer\"));break;case\"ImageServer\":u=h(e,{customParameters:t}).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?\"LERC\"!==r?.toUpperCase()||e.cacheType&&\"elevation\"!==e.cacheType.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\"}));break;case\"SceneServer\":u=h(s.url.path,{customParameters:t}).then((e=>{if(e){if(\"Voxel\"===e?.layerType)return\"VoxelLayer\";if(e?.layers&&Array.isArray(e.layers)&&e.layers.length>0){const r={Point:\"SceneLayer\",\"3DObject\":\"SceneLayer\",IntegratedMesh:\"IntegratedMeshLayer\",PointCloud:\"PointCloudLayer\",Building:\"BuildingSceneLayer\"},a=e.layers[0]?.layerType;if(null!=r[a])return r[a]}}return\"SceneLayer\"}));break;default:u=y[n]}const i={FeatureLayer:!0,SceneLayer:!0},c=\"FeatureServer\"===n,f={parsedUrl:s,Constructor:null,layerOrTableId:c?o:null,sublayerIds:null,tableIds:null},m=await u;if(i[m]&&null==o){const r=await p(e,n,t);c&&(f.sublayerInfos=r.layerInfos,f.tableInfos=r.tableInfos);1!==r.layerIds.length+r.tableIds.length?(f.sublayerIds=r.layerIds,f.tableIds=r.tableIds):c&&(f.layerOrTableId=r.layerIds[0]??r.tableIds[0],f.sourceJSON=r.layerInfos[0]??r.tableInfos[0])}return f.Constructor=await S(m),f}async function d(e,r){const a=await h(e,{customParameters:r});let l=null,u=null;const y=a.type;if(\"Feature Layer\"===y||\"Table\"===y?(l=\"FeatureServer\",u=a.id):\"indexedVector\"===y?l=\"VectorTileServer\":a.hasOwnProperty(\"mapName\")?l=\"MapServer\":a.hasOwnProperty(\"bandCount\")&&a.hasOwnProperty(\"pixelSizeX\")?l=\"ImageServer\":a.hasOwnProperty(\"maxRecordCount\")&&a.hasOwnProperty(\"allowGeometryUpdates\")?l=\"FeatureServer\":a.hasOwnProperty(\"streamUrls\")?l=\"StreamServer\":m(a)?(l=\"SceneServer\",u=a.id):a.hasOwnProperty(\"layers\")&&m(a.layers?.[0])&&(l=\"SceneServer\"),!l)return null;const i=null!=u?o(e):null;return{title:t(i)&&a.name||s(e),serverType:l,sublayer:u,url:{path:t(i)?i.serviceUrl:n(e).path}}}function m(e){return e?.hasOwnProperty(\"store\")&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function p(e,r,a){let t,s=!1;if(\"FeatureServer\"===r){const r=await b(e,{customParameters:a});s=!!r.layersJSON,t=r.layersJSON||r.serviceJSON}else t=await h(e,{customParameters:a});const n=t?.layers,l=t?.tables;return{layerIds:n?.map((e=>e.id)).reverse()||[],tableIds:l?.map((e=>e.id)).reverse()||[],layerInfos:s?n:[],tableInfos:s?l:[]}}function I(e){return!e.type||\"Feature Layer\"===e.type}async function b(e,r){let a=await h(e,r);a=a||{},a.layers=a.layers?.filter(I)||[];const t={serviceJSON:a};if(a.currentVersion<10.5)return t;const s=await h(e+\"/layers\",r);return t.layersJSON={layers:s?.layers?.filter(I)||[],tables:s?.tables||[]},t}async function S(e){return(0,u[e])()}async function w(e,r){return(await h(e,{customParameters:r})).tileInfo}async function h(r,a){return(await e(r,{responseType:\"json\",query:{f:\"json\",...a?.customParameters,token:a?.apiKey}})).data}export{b as fetchFeatureService,y as fromUrl};\n"],"names":["r","t","s","l","a","o","n","u","e"],"mappings":"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"}